---
title: "TRIP GENERATION RATES"
output: html_document
editor_options: 
  chunk_output_type: console
---
```{r, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning=FALSE, message=FALSE, 
                      fig.pos = 'H', fig.cap=T)

library(DT)
library(dplyr)
library(tidyverse)

# Get trip gen rates
setwd('../..')
data_path = getwd()
tg_data <- read_csv("./FinalData/input/trip_gen_4purpose.csv") %>% 
  mutate (HHSize = case_when(HHSize == "HHSize4p" ~ "4+",
                            HHSize == "HHSize3" ~ "3",
                            HHSize == "HHSize2" ~ "2",
                            HHSize == "HHSize1" ~ "1",
                            TRUE ~ "Non-home"),
         VehOwn = case_when(VehOwn == "Veh3p" ~ "3+",
                            VehOwn == "Veh2" ~ "2",
                            VehOwn == "Veh1" ~ "1",
                            VehOwn == "Veh0" ~ "0",
                            TRUE ~ "Non-home"),
         Workers = case_when(Workers == "worker3p" ~ "3+",
                             Workers == "worker2" ~ "2",
                             Workers == "worker1" ~ "1",
                             Workers == "worker0" ~ "0",
                             TRUE ~ "Non-home"),
         Income = case_when(Income == "Income4" ~ "4",
                            Income == "Income3" ~ "3",
                            Income == "Income2" ~ "2",
                            Income == "Income1" ~ "1",
                            TRUE ~ "Non-home"))

tg_data_p <- tg_data %>%
  mutate(Activity = HHType, `HH Size` = HHSize, `Number of Vehicles` = VehOwn, `Number of Workers` = Workers,
         HBW = HBW_P, HBO = HBO_P, `HB School` = HBSch_P, NHB = NHB_P) %>% 
  select(Activity, `HH Size`, Income, `Number of Vehicles`, `Number of Workers`, LU, HBW, HBO, `HB School`, NHB) 
  

tg_data_a <- tg_data %>%  
  mutate(Activity = HHType, `HH Size` = HHSize, `Number of Vehicles` = VehOwn, `Number of Workers` = Workers,
         HBW = HBW_A, HBO = HBO_A, `HB School` = HBSch_A, NHB = NHB_A) %>% 
  select(Activity, `HH Size`, Income, `Number of Vehicles`, `Number of Workers`, HBW, HBO, `HB School`, NHB) 

```


This page provides a rundown of the trip generation rates used in step 4 of the
West Station area study. Trips are generated by households, jobs, schools, etc.
Household characteristics are important determinants of how many trips are likely
to be made by each household for different travel purposes. Four key household
characteristics were used for the trip generation analysis: household size,
household income, vehicle ownership, and number of workers.

Base year and forecast year estimates of households specify the number of 
households in respective subgroups along each of these dimensions for all
model area TAZs. For example, there are estimates for each TAZ specifying the 
number of one-person households, two-person households, three-person households,
and four-or-more person households; and separate estimates specifying the number
of zero-car households, one-car, two-car, and three-or-more-car households.

Trip generation rates, however, are specified at a more detailed level, such
that these dimensions need to be combined. Each household's size, income, 
number of vehicles, and number of workers is needed to model trip generation.
The accessibility-based model includes an iterative proportional fitting (IPF)
module to cross-classify households, estimating the number of households by 
detailed combinations of characteristics for each zone.

The detailed trip generation rates can be explored in the tabs below. For 
"non-home" trip generators (jobs, school enrollments, e.g.), the columns 
reflecting household dimensions have the value "Non-home". Use the filters
above each column to search and sort the tables. Note that rates are specified
for impossible household types - like one-person households with two workers - 
but these are precluded in the cross-classification process.

# Rate details {.tabset}
## Productions
The table below presents trip generation rates for person trip productions by
travel purpose:

  - HBW = Home-based work
  - HBO = Home-based other
  - HB School = Home-based school
  - NHB = Non-home-based
  
Note that NHB trip productions are estimated based on household characteristics,
but as non-home-based trips, they do not begin or end at the household location.
The household characteristics inform the magnitude of NHB trip productions, and
these are spatially redistributed to match the locations for NHB attractions.

In addition to households characteristics, trip generation is also influenced by
land use context. Three land use categories are specified in the regional travel
demand model, and their influence on trip generation rates is reflected in the
table. The land use categories break down as follows:

 - 1 = High density nodes (such as the Financial District, Cambridge, or Lowell)
 - 2 = Moderate density residential areas (as in Newton or Hyde Park)
 - 3 = Low density areas


```{r}
datatable(tg_data_p, filter='top', options=list(pageLength=10, autoWidth=TRUE))
```


## Attractions
The table below presents trip generation rates for person trip attractions by
travel purpose:

  - HBW = Home-based work
  - HBO = Home-based other
  - HB School = Home-based school
  - NHB = Non-home-based
  
Note that households have attraction potential for the HBO purpose, reflecting
social travel. There is no land use factor in estimating person trip attractions.
Key non-home categories include:

  - Basic = basic-sector jobs
  - Retail = retail jobs
  - Service = service jobs, which are broken down as follows:
    - K12_Emp = education jobs for K-12 schools
    - College_Emp = education jobs at colleges, universities, etc.
    - Other_Service_Emp = non-education service jobs
  - EnrollK12 = school enrollment at K-12 schools
  - EnrollCU = school enrollment at colleges and universities
  - EnrollPrek = school enrollment at pre-kindergarten
  - Dorm_Pop = population living in dorms

```{r}
datatable(tg_data_a, filter='top', options=list(pageLength=10, autoWidth=TRUE))
```


