---
title: "WEST STATION SCENARIO COMPARISONS"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning=FALSE, message=FALSE, 
                      fig.pos = 'H', fig.cap=T)
library(tidyverse)
library(rpgcolorsr)
library(gridExtra)
library(stringr)
```

This page provides summary comparisons of six different scenarios analyzed for
the West Station Area using the accessibility-based travel model. The summary
data and visualizations shown provide examples of the potential comparative
analyses supported by the model rather than an exhaustive menu of metrics.

The scenarios analyzed include:

1. Base

2. LRTP

3. RailVision

4. BRT - FEIR

5. BRT - Alt A

6. BRT - Alt B

Use the tabs below to compare scenario outputs across key model steps.

## {.tabset}
### Trip generation
How many trips generated by geographic area?


```{r, eval = TRUE}
# Get zone tags

setwd('K:/Projects/MAPC/FinalData/lu')
data_path = getwd()
print(data_path)
dir_names <- list.dirs(data_path, recursive=FALSE)
# plt <- lapply(dir_names, function(x) {
#   trips_f <- file.path(x, "trip_gen_summary.csv")
#   trips <- read_csv(trips_f) %>% 
#     filter(INFOCUS == 1) %>% 
#     ggplot() + geom_bar(
#       aes(x=End, y=Trips, fill=Purpose), position="stack", stat="identity", color="#FFFFFF") +
#     scale_fill_manual(values=rpg_cols(c("green", "orange", "blue", "shale")) %>% 
#                         unname()) + 
#     labs(title= paste("Scenario:", basename((x))))
# 
#   return (trips)
#   #hh_f <- file.path(x, "hh_by_type_sum.csv")
#   #hh <- read_csv(hh_f)
#   
# }
# )
# grid.arrange(plt[[1]], plt[[2]], plt[[3]], plt[[4]], nrow=2)


# Create the data for plotting
trip_data = lapply(dir_names, function(x){
  fname = file.path(x, "trip_gen_summary.csv")
  trips = read_csv(fname) %>%
    filter(INFOCUS == 1) %>%
    mutate(Scenario = basename(x))
  return(trips)
}) %>% bind_rows
# Plot, with unique windows for each scenario 
trip_plot = ggplot(data = trip_data) +
  geom_bar(
    aes(x=End, y=Trips, fill=Purpose), position="stack", stat="identity", color="#ffffff") +
  scale_fill_manual(values = rpg_cols(c("green", "orange", "blue", "shale")) %>% 
                         unname()) +
  #scale_y_continuous(breaks = seq(0, 150000, by = 30000)) +
  facet_wrap(~Scenario, nrow = 1)
# Show the plot
#print(trip_plot)
trip_plot

```

Vehicle ownership in the focus area.
```{r, eval = TRUE}
# Get zone tags

setwd('K:/Projects/MAPC/FinalData/lu')

# Create the data for plotting
hh_data = lapply(dir_names, function(x){
  fname = file.path(x, "hh_by_type_sum.csv")
  hh = read_csv(fname) %>%
    filter(INFOCUS == 1) %>%
    mutate(HHSize= lapply(HHType, function(x){str_split(x, "_")[[1]][1]}) %>% unlist,
           Income= lapply(HHType, function(x){str_split(x, "_")[[1]][2]}) %>% unlist,
           Workers= lapply(HHType, function(x){str_split(x, "_")[[1]][3]}) %>% unlist,
           Vehicle= lapply(HHType, function(x){str_split(x, "_")[[1]][4]}) %>% unlist,
           Scenario = basename(x))
  return(hh)
}) %>% bind_rows

hh_sum <- hh_data %>%  group_by(Vehicle, Scenario) %>%  summarise(HH = sum(Households))

# Plot, with unique windows for each scenario 
hh_plot = ggplot(data = hh_sum) +
  geom_bar(
    aes(x=Scenario, y=HH, fill=Vehicle), position="stack", stat="identity", color="#ffffff") +
  scale_fill_manual(values = rpg_cols(c("green", "orange", "blue", "shale")) %>% 
                         unname()) +
  labs(title = "Households by vehicle ownership")
hh_plot

```

### Accessibility scores
Average HH access to jobs score by transit
Average HH access to jobs score by walking
Average HH access to jobs score by bicycling

### Mode Choice
Estimated mode shares
Transit ridership
Non-motorized trips

### Distribution
VMT
Average trip length

### TNC
Number of TNC trips
Trips from, to West Station



